<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Заказы</title>
  <style>
    body { font-family: Arial, sans-serif; }
    table { width: 100%; border-collapse: collapse; margin: 20px auto; max-width: 800px; }
    th, td { border: 1px solid #ccc; padding: 10px; text-align: left; }
    th { background-color: #f4f4f4; }
    caption { font-size: 1.5em; margin-bottom: 10px; }
    .form-container { max-width: 800px; margin: 20px auto; text-align: center; }
    input[type="text"] { padding: 10px; width: 200px; margin-right: 10px; }
    button { padding: 10px 20px; }
  </style>
</head>
<body>
  <table id="ordersTable">
    <caption>Заказы CraftShop</caption>
    <thead>
      <tr>
        <th>ID</th>
        <th>Имя покупателя</th>
        <th>Товар</th>
        <th>Телеграм</th>
      </tr>
    </thead>
    <tbody>
      <!-- Данные будут добавляться здесь -->
    </tbody>
  </table>

  <div class="form-container">
    <h2>Удалить заказ</h2>
    <input type="text" id="deleteId" placeholder="Введите ID заказа">
    <button id="deleteButton">Удалить</button>
    <p id="deleteMessage" style="color: red; margin-top: 10px;"></p>
  </div>

  <script>
    const API_URL = 'https://flax-swift-patio.glitch.me/orders'; // URL API

    // Функция добавления данных в таблицу
    function addOrderToTable(order) {
      const tableBody = document.querySelector('#ordersTable tbody');

      // Проверяем, чтобы в таблице было не больше 50 строк
      while (tableBody.rows.length >= 50) {
        tableBody.deleteRow(tableBody.rows.length - 1);
      }

      // Создаём новую строку
      const row = tableBody.insertRow(0); // Вставляем в начало таблицы

      // Заполняем ячейки
      row.insertCell(0).textContent = order.id || '-';
      row.insertCell(1).textContent = order.buyer || '-';
      row.insertCell(2).textContent = order.product || '-';
      row.insertCell(3).textContent = order.telegram || '-';
    }

    // Функция загрузки данных из API
    async function fetchOrders() {
      try {
        const response = await fetch(API_URL);
        if (!response.ok) throw new Error('Ошибка при загрузке данных');
        const data = await response.json();

        // Очищаем таблицу перед обновлением
        const tableBody = document.querySelector('#ordersTable tbody');
        tableBody.innerHTML = '';

        // Добавляем каждый заказ в таблицу
        data.forEach(order => addOrderToTable(order));
      } catch (error) {
        console.error('Ошибка загрузки данных:', error);
      }
    }

    // Функция удаления элемента по ID
    async function deleteOrderById(id) {
      try {
        const response = await fetch(`${API_URL}/${id}`, { method: 'DELETE' });
        if (response.ok) {
          document.getElementById('deleteMessage').textContent = `Заказ с ID ${id} успешно удалён!`;
          fetchOrders(); // Обновляем таблицу после удаления
        } else {
          throw new Error(`Не удалось удалить заказ с ID ${id}`);
        }
      } catch (error) {
        console.error('Ошибка удаления:', error);
        document.getElementById('deleteMessage').textContent = `Ошибка: ${error.message}`;
      }
    }

    // Обработчик для кнопки удаления
    document.getElementById('deleteButton').addEventListener('click', () => {
      const deleteId = document.getElementById('deleteId').value.trim();
      if (deleteId) {
        deleteOrderById(deleteId);
      } else {
        document.getElementById('deleteMessage').textContent = 'Пожалуйста, введите ID!';
      }
    });

    // Обновляем таблицу каждые 10 секунд
    setInterval(fetchOrders, 10000);
    fetchOrders();
  </script>
</body>
</html>
